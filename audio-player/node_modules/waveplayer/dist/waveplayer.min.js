"use strict";function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}var arrayWithoutHoles=_arrayWithoutHoles;function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}var iterableToArray=_iterableToArray;function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var nonIterableSpread=_nonIterableSpread;function _toConsumableArray(e){return arrayWithoutHoles(e)||iterableToArray(e)||nonIterableSpread()}var toConsumableArray=_toConsumableArray;function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var defineProperty=_defineProperty;function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){defineProperty(t,e,r[e])})}return t}var objectSpread=_objectSpread;function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var classCallCheck=_classCallCheck;function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var createClass=_createClass,Mediator=function(){function e(){classCallCheck(this,e),defineProperty(this,"_topics",void 0),this._topics={}}return createClass(e,[{key:"on",value:function(e,t){return this._topics.hasOwnProperty(e)||(this._topics[e]=[]),this._topics[e].push(t),!0}},{key:"un",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!this._topics.hasOwnProperty(e))return!1;if(t){for(var r=0;r<this._topics[e].length;r++)if(this._topics[e][r]===t)return this._topics[e].splice(r,1),!0;return!1}return delete this._topics[e],!0}},{key:"unAll",value:function(){this._topics=null}},{key:"fire",value:function(e){if(!this._topics.hasOwnProperty(e))return!1;for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=0;i<this._topics[e].length;i++)this._topics[e][i].apply(null,r);return!0}}]),e}();function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var _typeof_1=createCommonjsModule(function(t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?t.exports=n=function(e){return r(e)}:t.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)},n(e)}t.exports=n}),hex2rgb=function(e){var t=parseInt("#"===e.charAt(0)?e.substring(1,7):e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}},rgb2hsv=function(e){var t,r=e.r/255,n=e.g/255,i=e.b/255,o=Math.max(r,n,i),a=o-Math.min(r,n,i),s=function(e){return(o-e)/6/a+.5};if(0===a)return{h:0,s:0,v:Math.round(100*o)};var c=a/o,l=s(r),u=s(n),h=s(i);return r===o?t=h-u:n===o?t=1/3+l-h:i===o&&(t=2/3+u-l),t<0?t++:1<t&&t--,{h:Math.round(360*t),s:Math.round(100*c),v:Math.round(100*o)}},hsv2rgb=function(e){if(0===e.s)return{r:e.v,g:e.v,b:e.v};var t=e.h/60,r=Math.floor(t),n=e.s/100,i=e.v/100*255,o=[i*(1-n),i*(1-n*(t-r)),i*(1-n*(1-(t-r)))];switch(r){case 0:return{r:i,g:o[2],b:o[0]};case 1:return{r:o[1],g:i,b:o[0]};case 2:return{r:o[0],g:i,b:o[2]};case 3:return{r:o[0],g:o[1],b:i};case 4:return{r:o[2],g:o[0],b:i};default:return{r:i,g:o[0],b:o[1]}}},getJSON=function(n){return new Promise(function(e,t){var r=new XMLHttpRequest;r.open("GET",n),r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&(200===r.status?e(JSON.parse(r.responseText)):t(new Error(r.statusText)))},r.send()})},stateResolver=function(e){return function(){var s=e.apply(this,arguments);return new Promise(function(n,i){var e=function(e,t){try{var r=s[e](t);r.done?n(r.value):r.value.then(o,a)}catch(e){i(e)}},o=e.bind(null,"next"),a=e.bind(null,"throw");o()})}},style=function(e,t){for(var r in t)e.style[r]!==t[r]&&(e.style[r]=t[r]);return e},isObject=function(e){var t=_typeof_1(e);return null!==e&&("object"===t||"function"===t)},isString=function(e){var t=_typeof_1(e);return"string"===t||"object"===t&&null!==e&&!Array.isArray(e)&&"[object String]"===Object.prototype.toString.call(e)},WaveView=function(){function r(e,t){classCallCheck(this,r),defineProperty(this,"_defaultOptions",{container:null,width:512,height:128,waveColor:"#428bca",progressColor:"#31708f",barWidth:4,barGap:1,interact:!0,responsive:!0,progress:0,useGradient:!0}),defineProperty(this,"_data",null),defineProperty(this,"_options",void 0),defineProperty(this,"_container",void 0),defineProperty(this,"_waveContainer",void 0),defineProperty(this,"_canvasContext",void 0),defineProperty(this,"_colors",void 0),defineProperty(this,"_progress",0),WavePlayer._mediator||(WavePlayer._mediator=new Mediator),e&&this.drawWave(e,0),this._options=objectSpread({},this._defaultOptions,t),this.container="string"==typeof this._options.container?document.querySelector(this._options.container):this._options.container,this._createWaveContainer(),this._colors=this._createColorVariations(),this._initializeResizeHandler()}return createClass(r,[{key:"drawWave",value:function(e,t){this._data=e,this._progress=t,this._barData=this._calcAvgAmps(),this.clearWave(),this._drawBars(this._progress*this._waveContainer.clientWidth)}},{key:"updateWave",value:function(e){e&&(this._progress=e),this.clearWave(),this._drawBars(this._progress*this._waveContainer.clientWidth)}},{key:"clearWave",value:function(){this._canvasContext.clearRect(0,0,this._canvasContext.canvas.width,this._canvasContext.canvas.height)}},{key:"destroy",value:function(){this._removeCanvasHandlers(),this._resizeHandler&&window.removeEventListener("resize",this._resizeHandler),WavePlayer._mediator.unAll(),this._waveContainer&&this._container.removeChild(this._waveContainer),this._waveContainer=null}},{key:"_createWaveContainer",value:function(){this._waveContainer=document.createElement("div"),this._waveContainer.className="waveform-container",this._container.appendChild(this._waveContainer),style(this._waveContainer,{display:"block",position:"relative",width:this._options.responsive?"100%":"".concat(this._options.width,"px"),height:"".concat(this._options.height,"px"),overflow:"hidden"}),this._createCanvas()}},{key:"_createCanvas",value:function(){var e=this._waveContainer.clientWidth,t=this._waveContainer.appendChild(style(document.createElement("canvas"),{position:"absolute",top:0,bottom:0,zIndex:1,height:"".concat(this._options.height,"px"),width:"".concat(e,"px")}));this._canvasContext=t.getContext("2d"),this._canvasContext.canvas.width=e,this._canvasContext.canvas.height=this._options.height,this._options.interact&&this._addCanvasHandlers()}},{key:"_addCanvasHandlers",value:function(){var t=this;this._mouseClickHandler=function(e){return WavePlayer._mediator.fire("waveview:clicked",t._coord2Progress(e))},this._canvasContext.canvas.addEventListener("click",this._mouseClickHandler.bind(this))}},{key:"_removeCanvasHandlers",value:function(){this._mouseClickHandler&&this.canvasContext.canvas.removeEventListener("click",this._mouseClickHandler)}},{key:"_createColorVariations",value:function(){var e={waveColor:[],progressColor:[]};for(var t in e){var r=hex2rgb(this._options[t]);e[t].push(r),r=rgb2hsv(r),e[t].push(hsv2rgb({h:r.h,s:r.s,v:1.4*r.v}))}return e.dc={r:e.waveColor[0].r-e.progressColor[0].r,g:e.waveColor[0].g-e.progressColor[0].g,b:e.waveColor[0].b-e.progressColor[0].b},e}},{key:"_initializeResizeHandler",value:function(){var t=this;if(!this._options.responsive)return this._resizeHandler&&window.removeEventListener("resize",this._resizeHandler),void style(this._waveContainer,{width:this._options.width});style(this._waveContainer,{width:"100%"}),this._resizeHandler&&window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=function(){var e=t._waveContainer.clientWidth;style(t._canvasContext.canvas,{width:"".concat(e,"px")}),t._canvasContext.canvas.width=e,t._barData=t._calcAvgAmps(),t.updateWave(t._progress)},window.addEventListener("resize",this._resizeHandler)}},{key:"_calcAvgAmps",value:function(){var e,t,a=this,r=function(e,t,r,n){for(var i=0,o=t;o<=r;o++)i+=Math.abs(a._data[e+o]);return i/n},n=this._waveContainer.clientWidth,i=n!==this._data.length?this._data.length/n:1,o=this._options.barWidth+this._options.barGap,s=(o-1)/2,c=-~~s,l=o*i,u={amps:[],x:[]};for(s=Math.round(s),u.amps.push(r(0,0,s,o)),u.x.push(0),e=o,t=l;t+s<this._data.length;e+=o,t+=l)u.amps.push(r(~~t,c,s,o)),u.x.push(e);return s=-((t=~~t)-this._data.length+1),e<=n-o&&c<s&&(u.amps.push(r(t,c,s,s-c)),u.x.push(e)),u.norm=1/Math.max.apply(Math,u.amps),u}},{key:"_drawBars",value:function(e){if(this._barData){var t=this._canvasContext,r=t.canvas.height,n=this._options.barWidth+this._options.barGap,i=!0;t.fillStyle=this._options.useGradient?this._generateGradient(this._colors.progressColor,r):this._generateColor(this._colors.progressColor[0]);for(var o=0;o<this._barData.x.length;o++){var a=this._barData.x[o];if(e-n<=a&&i)if(e<=a)t.fillStyle=this._options.useGradient?this._generateGradient(this._colors.waveColor,r):this._generateColor(this._colors.waveColor[0]),i=!1;else{var s=(e-a)/n,c={r:this._colors.waveColor[0].r-this._colors.dc.r*s,g:this._colors.waveColor[0].g-this._colors.dc.g*s,b:this._colors.waveColor[0].b-this._colors.dc.b*s},l=null;this._options.useGradient&&(l=rgb2hsv(c),l=hsv2rgb({h:l.h,s:l.s,v:1.4*l.v})),t.fillStyle=this._options.useGradient?this._generateGradient([c,l],r):this._generateColor(c)}var u=Math.max(r*this._barData.amps[o]*this._barData.norm,.5);t.fillRect(a,(r-u)/2,this._options.barWidth,u)}}}},{key:"_generateGradient",value:function(e,t){var r=this._canvasContext.createLinearGradient(0,0,0,t),n="rgba(".concat(~~e[1].r,", ").concat(~~e[1].g,", ").concat(~~e[1].b,", 1)");return r.addColorStop(0,n),r.addColorStop(.3,"rgba(".concat(~~e[0].r,", ").concat(~~e[0].g,", ").concat(~~e[0].b,", 1)")),r.addColorStop(1,n),r}},{key:"_generateColor",value:function(e){return"rgb(".concat(~~e.r,", ").concat(~~e.g,", ").concat(~~e.b,")")}},{key:"_calcMouseCoordX",value:function(e){return e.preventDefault(),e.clientX-this._waveContainer.getBoundingClientRect().left}},{key:"_coord2Progress",value:function(e){return this._calcMouseCoordX(e)/this._waveContainer.clientWidth}},{key:"container",get:function(){return this._container},set:function(e){if(!e)throw new Error("Please supply a valid container element");this._container=e}},{key:"data",get:function(){return this._data},set:function(e){this._data=e}},{key:"interact",get:function(){return this._options.interact},set:function(e){(this._options.interact=e)?this._addCanvasHandlers():this._removeCanvasHandlers()}},{key:"responsive",get:function(){return this._options.responsive},set:function(e){this._options.responsive=e,this._initializeResizeHandler()}},{key:"width",get:function(){return this._waveContainer.clientWidth},set:function(e){this._options.width=e,this._options.responsive||(style(this._waveContainer,{width:"".concat(this._options.width,"px")}),style(this._canvasContext.canvas,{width:"".concat(this._options.width,"px")}),this._canvasContext.canvas.width=this._options.width,this._barData=this._calcAvgAmps())}},{key:"height",get:function(){return this._waveContainer.clientHeight},set:function(e){this._options.height=e,style(this._waveContainer,{height:"".concat(this._options.height,"px")}),style(this.canvasContext.canvas,{height:"".concat(this._options.height,"px")}),this._canvasContext.canvas.height=this._options.height,this._barData=this._calcAvgAmps()}},{key:"useGradient",get:function(){return this._options.useGradient},set:function(e){this._options.useGradient=e}}]),r}(),runtime=createCommonjsModule(function(L){!function(e){var c,t=Object.prototype,l=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag",a=e.regeneratorRuntime;if(a)L.exports=a;else{(a=e.regeneratorRuntime=L.exports).wrap=m;var h="suspendedStart",d="suspendedYield",v="executing",p="completed",_={},s={};s[i]=function(){return this};var u=Object.getPrototypeOf,f=u&&u(u(S([])));f&&f!==t&&l.call(f,i)&&(s=f);var y=k.prototype=w.prototype=Object.create(s);b.prototype=y.constructor=k,k.constructor=b,k[o]=b.displayName="GeneratorFunction",a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(y),e},a.awrap=function(e){return{__await:e}},C(E.prototype),E.prototype[n]=function(){return this},a.AsyncIterator=E,a.async=function(e,t,r,n){var i=new E(m(e,t,r,n));return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},C(y),y[o]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},a.keys=function(r){var n=[];for(var e in r)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&l.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=c)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=c),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=l.call(i,"catchLoc"),s=l.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&l.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,_):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),_}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=c),_}}}function m(e,t,r,n){var o,a,s,c,i=t&&t.prototype instanceof w?t:w,l=Object.create(i.prototype),u=new O(n||[]);return l._invoke=(o=e,a=r,s=u,c=h,function(e,t){if(c===v)throw new Error("Generator is already running");if(c===p){if("throw"===e)throw t;return A()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var n=x(r,s);if(n){if(n===_)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(c===h)throw c=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);c=v;var i=g(o,a,s);if("normal"===i.type){if(c=s.done?p:d,i.arg===_)continue;return{value:i.arg,done:s.done}}"throw"===i.type&&(c=p,s.method="throw",s.arg=i.arg)}}),l}function g(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function w(){}function b(){}function k(){}function C(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function E(c){var t;this._invoke=function(r,n){function e(){return new Promise(function(e,t){!function t(e,r,n,i){var o=g(c[e],c,r);if("throw"!==o.type){var a=o.arg,s=a.value;return s&&"object"==typeof s&&l.call(s,"__await")?Promise.resolve(s.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):Promise.resolve(s).then(function(e){a.value=e,n(a)},function(e){return t("throw",e,n,i)})}i(o.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}}function x(e,t){var r=e.iterator[t.method];if(r===c){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=c,x(e,t),"throw"===t.method))return _;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var n=g(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,_;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=c),t.delegate=null,_):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,_)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(l.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=c,e.done=!0,e};return n.next=n}}return{next:A}}function A(){return{value:c,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())}),g=function(){return this||"object"==typeof self&&self}()||Function("return this")(),hadRuntime=g.regeneratorRuntime&&0<=Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime"),oldRuntime=hadRuntime&&g.regeneratorRuntime;g.regeneratorRuntime=void 0;var runtimeModule=runtime;if(hadRuntime)g.regeneratorRuntime=oldRuntime;else try{delete g.regeneratorRuntime}catch(e){g.regeneratorRuntime=void 0}var regenerator=runtimeModule,Playlist=function(){function n(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(classCallCheck(this,n),defineProperty(this,"_defaultOptions",{autoPlay:!1}),defineProperty(this,"_options",void 0),defineProperty(this,"_scheduler",void 0),defineProperty(this,"_wavePlayer",void 0),defineProperty(this,"_urls",void 0),defineProperty(this,"_audioElm",void 0),defineProperty(this,"_currentTrackIndex",void 0),defineProperty(this,"_skipped",!1),!(t&&t instanceof Array))throw new TypeError("Argument 'urls' is invalid.");if(0===t.length)throw new Error("Argument 'urls' needs to contain at least 1 item.");if(!isObject(r))throw new TypeError("Argument 'options' is invalid.");WavePlayer._mediator||(WavePlayer._mediator=new Mediator),this._options=objectSpread({},this._defaultOptions,r),this._wavePlayer=e,this._urls=t,this._audioElm=this._wavePlayer._audioElm,this._scheduler=this._createScheduler(t,this._options.autoplay)}return createClass(n,[{key:"next",value:function(){this._currentTrackIndex<this._urls.length&&(this._skipped=!0,this._audioElm.dispatchEvent(new Event("ended")))}},{key:"previous",value:function(){0<this._currentTrackIndex&&(this._currentTrackIndex-=2,this._skipped=!0,this._audioElm.dispatchEvent(new Event("ended")))}},{key:"skipTo",value:function(e){var t=e-1;t!==this._currentTrackIndex&&t<this._urls.length&&0<=t&&(this._currentTrackIndex=t-1,this._skipped=!0,this._audioElm.dispatchEvent(new Event("ended")))}},{key:"destroy",value:function(){this._wavePlayer.pause(),this._scheduler=null}},{key:"_createScheduler",value:function(e,a){var t=this;this._currentTrackIndex=0;var r=stateResolver(regenerator.mark(function e(t,r){var n,i,o;return regenerator.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r._currentTrackIndex<t.length)return n=isObject(t[r._currentTrackIndex])?t[r._currentTrackIndex]:{url:t[r._currentTrackIndex],data:null},i=n.url,o=n.data,e.next=4,r._wavePlayer.load(i,o);e.next=10;break;case 4:return 0<r._currentTrackIndex?(WavePlayer._mediator.fire("waveplayer:playlist:next",r._wavePlayer,{url:t[r._currentTrackIndex],trackNumber:r._currentTrackIndex+1}),r._wavePlayer.play()):(WavePlayer._mediator.fire("waveplayer:playlist:ready",r._wavePlayer),(a||r._skipped)&&r._wavePlayer.play()),e.next=7,r._onEnd();case 7:r._currentTrackIndex++,e.next=0;break;case 10:return e.abrupt("return",r._currentTrackIndex);case 11:case"end":return e.stop()}},e,this)}));return r(e,this).then(function(e){t._skipped=!1,WavePlayer._mediator.fire("waveplayer:playlist:finished",t._wavePlayer,e)}),r}},{key:"_onEnd",value:function(){var t=this;return new Promise(function(e){t._ended&&t._audioElm.removeEventListener("ended",t._ended),t._ended=function(){return e("ended")},t._audioElm.addEventListener("ended",t._ended.bind(t))})}}]),n}(),WavePlayer=function(){function n(e){var t=this;classCallCheck(this,n),defineProperty(this,"_defaultOptions",{preload:"metadata"}),defineProperty(this,"_options",void 0),defineProperty(this,"_waveView",void 0),defineProperty(this,"_audioElm",void 0),defineProperty(this,"_playlist",void 0),defineProperty(this,"_currentTime",void 0),n._mediator||(n._mediator=new Mediator),this._options=objectSpread({},this._defaultOptions,e),this._waveView=new WaveView(null,objectSpread({},this._options)),Promise.all([this._initializeAudioElm(),this._initializeWaveViewInteraction()]).then(function(){return n._mediator.fire("waveplayer:initialized",t)})}return createClass(n,[{key:"load",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return Promise.all([this.loadAudio(e),this.loadWaveform(t||this._jsonUrl(e))])}},{key:"loadAudio",value:function(t){var r=this;return new Promise(function(e){r._audioElm.src=t,r._audioElm.load(),r._currentTime=0,n._mediator.on("waveplayer:canplay",function(){return e()})})}},{key:"loadWaveform",value:function(e){return isString(e)?this._getWaveformData(e):Promise.resolve(this._waveView.drawWave(isObject(e)?toConsumableArray(e[Object.keys(e)[0]]):toConsumableArray(e),0))}},{key:"play",value:function(){this._audioElm.play()}},{key:"pause",value:function(){this._audioElm.pause()}},{key:"skipTo",value:function(e){this._audioElm.currentTime=e}},{key:"isPlaying",value:function(){return!this._audioElm.paused}},{key:"on",value:function(e,t){n._mediator.on(e,t)}},{key:"un",value:function(e,t){n._mediator.un(e,t)}},{key:"createPlaylist",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.cancelPlaylist(),this._playlist=new Playlist(this,e,t),this._playlist}},{key:"cancelPlaylist",value:function(){this._playlist&&this._playlist.destroy()}},{key:"destroy",value:function(){this.pause(),this.cancelPlaylist(),n._mediator.unAll(),this._audioElm&&(this._audioElm.removeEventListener("canplay",this._canplayHandler),this._audioElm.removeEventListener("error",this._errorHandler),this._audioElm.removeEventListener("timeupdate",this._timeUpdateHandler),this._ended&&this._audioElm.removeEventListener("ended",this._ended),this._audioElm.parentNode&&this._audioElm.parentNode.removeChild(this._audioElm),this._audioElm=null),this._waveView.destroy()}},{key:"_initializeWaveViewInteraction",value:function(){var r=this;return Promise.resolve((r._onClickHandler&&n._mediator.un("waveview:clicked",r._onClickHandler),r._onClickHandler=function(e){if(r.isPlaying()){var t=r._progressToDuration(e);r.skipTo(t),n._mediator.fire("waveplayer:skipped",r,t)}},void n._mediator.on("waveview:clicked",r._onClickHandler.bind(r))))}},{key:"_initializeAudioElm",value:function(){var r=this;return new Promise(function(e,t){r._waveView.container.querySelector("audio")&&(r._audioElm.removeEventListener("canplay",r._canplayHandler),r._audioElm.removeEventListener("error",r._errorHandler),r._audioElm.removeEventListener("timeupdate",r._timeUpdateHandler),r._waveView.container.removeChild(r._audioElm)),r._audioElm=r._createAudioElm(),r._waveView.container.appendChild(r._audioElm),r._canplayHandler=function(){n._mediator.fire("waveplayer:canplay",r),e("waveplayer:canplay")},r._audioElm.addEventListener("canplay",r._canplayHandler.bind(r)),r._errorHandler=function(e){switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:t(new Error("Fetching process aborted by user"));break;case e.target.error.MEDIA_ERR_NETWORK:t(new Error("There was a problem downloading the audio file"));break;case e.target.error.MEDIA_ERR_DECODE:t(new Error("There was a problem decoding the audio file"));break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:t(new Error("Audio is not supported, check the provided URL"));break;default:t(new Error("An unknown error occurred"))}},r._audioElm.addEventListener("error",r._errorHandler.bind(r)),r._timeUpdateHandler=function(e){r._currentTime=e.target.currentTime,r._waveView.updateWave(r._durationToProgress(r._currentTime))},r._audioElm.addEventListener("timeupdate",r._timeUpdateHandler.bind(r))})}},{key:"_createAudioElm",value:function(){var e=document.createElement("audio");return e.controls=!1,e.autoplay=!1,e.preload=this._options.preload,e}},{key:"_getWaveformData",value:function(e){var n=this;return new Promise(function(t,r){getJSON(e).then(function(e){n._waveView.drawWave(isObject(e)?e[Object.keys(e)[0]]:e,0),t("waveplayer:json:fetched")}).catch(function(e){return r(e)})})}},{key:"_durationToProgress",value:function(e){return e/this._audioElm.duration}},{key:"_progressToDuration",value:function(e){return e*this._audioElm.duration}},{key:"_jsonUrl",value:function(e){return"".concat(e.substr(0,e.lastIndexOf(".")),".json")}},{key:"volume",get:function(){return this._audioElm.volume},set:function(e){this._audioElm.volume=e}},{key:"interact",get:function(){return this._waveView.interact},set:function(e){this._waveView.interact=e}},{key:"responsive",get:function(){return this._waveView.responsive},set:function(e){this._waveView.responsive=e}},{key:"playlist",get:function(){return this._playlist?this._playlist:null}},{key:"currentTime",get:function(){return this._currentTime}},{key:"duration",get:function(){return this._audioElm.duration}}]),n}();defineProperty(WavePlayer,"_mediator",void 0),module.exports=WavePlayer;
//# sourceMappingURL=waveplayer.min.js.map
